<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Cat Gachaï½œè²“å’ªè½‰è›‹æ©Ÿ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== Anime Pastel Style ===== */
body {
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #ffe6f3, #e1f5fe);
  font-family: "Noto Sans TC", sans-serif;
  color: #444;
  display: flex;
  justify-content: center;
  min-height: 100vh;
}

#app {
  width: 100%;
  max-width: 480px;
  background: #ffffffdd;
  padding: 20px;
  margin: 20px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  backdrop-filter: blur(5px);
}

h1 {
  text-align: center;
  font-size: 1.8em;
  color: #d81b60;
  text-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

button {
  width: 100%;
  padding: 12px;
  font-size: 1.1em;
  margin-top: 10px;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  background: #f48fb1;
  color: white;
  transition: 0.3s;
}

button:hover {
  background: #ec407a;
}

#result-area {
  margin-top: 20px;
  text-align: center;
}

#cat-img {
  width: 90%;
  max-height: 300px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  margin-bottom: 10px;
}

.rarity-label {
  font-size: 1.3em;
  font-weight: bold;
  margin: 10px 0;
  padding: 6px 12px;
  display: inline-block;
  border-radius: 12px;
}

.storage-btn {
  background: #ba68c8;
}

.delete-btn {
  background: #90a4ae;
}

#storage-box {
  margin-top: 25px;
}

.storage-title {
  font-size: 1.4em;
  font-weight: bold;
  margin-bottom: 10px;
  color: #6a1b9a;
}

.storage-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}

.storage-item img {
  width: 100%;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

/* rarity colors */
.rarity-L { background: linear-gradient(90deg,#ff4081,#7c4dff); color:#fff; }
.rarity-UR { background: #7e57c2; color:white; }
.rarity-SR { background: #42a5f5; color:white; }
.rarity-R { background: #26a69a; color:white; }
.rarity-U { background: #ffca28; color:white; }
.rarity-N { background: #bdbdbd; color:white; }

</style>
</head>
<body>

<div id="app">
  <h1>ğŸ± è²“å’ªè½‰è›‹æ©Ÿ Gacha</h1>

  <!-- æŠ½å¡æŒ‰éˆ• -->
  <button id="gacha-btn">ğŸ æŠ½ä¸€éš»è²“å’ªï¼</button>

  <!-- æŠ½å¡çµæœ -->
  <div id="result-area" style="display:none;">
    <img id="cat-img" src="">
    <div id="rarity-tag" class="rarity-label"></div>

    <button class="storage-btn" id="save-btn">ğŸ“¦ åŠ å…¥å„²è—åº«</button>
    <button class="delete-btn" id="discard-btn">ğŸ—‘ï¸ ä¸Ÿæ£„</button>
  </div>

  <!-- å„²è—åº« -->
  <div id="storage-box">
    <div class="storage-title">ğŸ“¦ è²“å’ªå„²è—åº«</div>
    <div class="storage-grid" id="storage-grid"></div>
  </div>
</div>

<script>
// =============================
//  You MUST replace API KEY â†“
// =============================
const API_KEY = "PUT-YOUR-THECATAPI-KEY-HERE";

// =============================
//  Rarity Rates è¨­å®šï¼ˆ0.1% ~ 60%ï¼‰
// =============================
const rarityTable = [
  { type: "Legend",   rate: 0.1,  class: "rarity-L" },
  { type: "Ultra Rare", rate: 1,  class: "rarity-UR" },
  { type: "Super Rare", rate: 5,  class: "rarity-SR" },
  { type: "Rare",       rate: 15, class: "rarity-R" },
  { type: "Uncommon",   rate: 20, class: "rarity-U" },
  { type: "Normal",     rate: 60, class: "rarity-N" },
];

// æŠŠç¨€æœ‰åº¦è½‰æˆç´¯ç©æ©Ÿç‡
function getRandomRarity() {
  let random = Math.random() * 100;
  let sum = 0;
  for (let r of rarityTable) {
    sum += r.rate;
    if (random <= sum) return r;
  }
}

// =============================
//  å„²è—åº«é‚è¼¯ï¼ˆlocalStorageï¼‰
// =============================
let storage = JSON.parse(localStorage.getItem("catStorage") || "[]");

function renderStorage() {
  const grid = document.getElementById("storage-grid");
  grid.innerHTML = "";
  storage.forEach(cat => {
    let div = document.createElement("div");
    div.className = "storage-item";
    div.innerHTML = `<img src="${cat.url}" title="${cat.rarity}">`;
    grid.appendChild(div);
  });
}

renderStorage();

// =============================
// æŠ½å¡é‚è¼¯
// =============================
document.getElementById("gacha-btn").addEventListener("click", async () => {
  const rarity = getRandomRarity();

  // æŠ“ TheCatAPI åœ–ç‰‡
  const res = await fetch("https://api.thecatapi.com/v1/images/search", {
    headers: { "x-api-key": API_KEY }
  });
  const data = await res.json();
  const imgUrl = data[0].url;

  // é¡¯ç¤ºçµæœ
  document.getElementById("result-area").style.display = "block";
  document.getElementById("cat-img").src = imgUrl;

  const tag = document.getElementById("rarity-tag");
  tag.textContent = rarity.type + `ï¼ˆ${rarity.rate}%ï¼‰`;
  tag.className = `rarity-label ${rarity.class}`;

  // è¨˜éŒ„æš«å­˜æŠ½åˆ°çš„è²“
  window.currentCat = { url: imgUrl, rarity: rarity.type };
});

// =============================
// å„²è—æŒ‰éˆ•
// =============================
document.getElementById("save-btn").addEventListener("click", () => {
  if (!window.currentCat) return;
  storage.push(window.currentCat);
  localStorage.setItem("catStorage", JSON.stringify(storage));
  renderStorage();
  alert("å·²åŠ å…¥å„²è—åº«ï¼");
});

// =============================
// ä¸Ÿæ£„æŒ‰éˆ•
// =============================
document.getElementById("discard-btn").addEventListener("click", () => {
  window.currentCat = null;
  document.getElementById("result-area").style.display = "none";
  alert("å·²ä¸Ÿæ£„é€™éš»è²“å’ªï¼");
});
</script>

</body>
</html>
